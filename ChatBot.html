<!DOCTYPE html>
<html>
    <!--Head es para darle info a la pagina, algo que no se renderiza-->
    <head>
        <meta charset="utf-8"> <!--Codificacion-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!--Adapta el contenido al tamaño de la pantalla el dispositivo-->

        <meta name="robots"content="index, follow"> <!--Indexar pagina y seguir enlaces-->

        <title>Ansiedad Tecnológica</title> <!--Titulo de la pestaña-->
        <link rel="stylesheet" href="Css/Estilos.css">
        <meta name="description" content="AnsiedadTecnologica">

        <meta property="og:title" content="AnsiedadTecnologica">
        <meta property="og:description" content="Ansiedad Tecnologica">

        <meta name="theme-color"content="#09f">
        <link rel="icon" type="Imagenes/jpg" href="Imagenes/IconoDePestaña.png">

        <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">

    </head>
    
<body>

    <!--Header menu El h1, h2, h3, etc se usan para Titulos con diferentes tamaño dependiendo de cada etiqueta -->
    <header>
        <div class="header-content">
            <div class="logo">
                <h1>Ansiedad <b>Tecnológica</b></h1>
            </div> 
    <div class="menu">
        <nav>
        <ul>
            <li class="menu-selected"><a href= "index.html" >Inicio</a></li>
            <li class="introduccion-selected"><a href="Introduccion.html" > Introduccion</a></li>
            <li class="causa-selected"><a href="Causas.html" > Causas</a></li>
            <li class="efecto-selected"><a href="Efectos.html">Efectos</a></li>
            <li class="recurso-selected"><a href="Recursos.html" >Recursos </a> </li>
            <li class="ChatBot-selected"><a href="ChatBot.html" >ChatBot </a> </li>
        </ul>
        </nav>
            </div>
        </div>  
        </header>


<div class="container-content-ChatBot">
    <article class="ChatBot" id="ChatBot">
        <h1 class="Titulo">ChatBot</h1>
        <div id="chatbox"></div>
        <div class="input-area">
            <input type="text" id="inputText" placeholder="Escribe tu mensaje...">
            <button id="sendMessage">Enviar</button>
        </div>
        <script type="importmap">
            {
                "imports": {
                    "@google/generative-ai": "https://esm.run/@google/generative-ai@0.3.0"
                }
            }
        </script>
<script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai@0.3.0";

    const API_KEY = "AIzaSyBDV6sxi_2qyHU6ppYC5OmrJ4XefusTjhY";
    
    // Conexión más robusta
    const genAI = new GoogleGenerativeAI(API_KEY, {
        apiBase: "https://generativelanguage.googleapis.com/v1beta"
    });

    const model = genAI.getGenerativeModel({
        model: "gemini-1.0-pro",
        generationConfig: {
            temperature: 0.9,
            topP: 1,
            topK: 40
        }
    });

    // Elementos del DOM
    const chatbox = document.getElementById('chatbox');
    const inputText = document.getElementById('inputText');
    const sendButton = document.getElementById('sendMessage');
    let isWaitingForResponse = false;

    // Mensaje de bienvenida
    displayMessage("¡Hola! Soy tu asistente de IA. ¿En qué puedo ayudarte hoy?", 'assistant');

    // Event listeners
    inputText.addEventListener('keypress', (e) => e.key === 'Enter' && sendMessage());
    sendButton.addEventListener('click', sendMessage);

    async function sendMessage() {
        if (isWaitingForResponse) return;
        
        const userInput = inputText.value.trim();
        if (!userInput) return;
        
        inputText.value = '';
        displayMessage(userInput, 'user');
        
        const typingId = showTypingIndicator();
        isWaitingForResponse = true;
        sendButton.disabled = true;

        try {
            // Método más confiable usando fetch directamente
            const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.0-pro:generateContent?key=${API_KEY}`,
                {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: userInput }]
                        }]
                    })
                }
            );
            
            if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
            
            const data = await response.json();
            const reply = data.candidates[0].content.parts[0].text;
            displayMessage(reply, 'assistant');
            
        } catch (error) {
            console.error("Error completo:", error);
            displayMessage("⚠️ Por favor, recarga la página e intenta nuevamente", 'assistant');
        } finally {
            removeTypingIndicator(typingId);
            isWaitingForResponse = false;
            sendButton.disabled = false;
        }
    }

    function showTypingIndicator() {
        const id = "typing-" + Date.now();
        chatbox.innerHTML += `<div id="${id}" class="typing-indicator"><span>.</span><span>.</span><span>.</span></div>`;
        chatbox.scrollTop = chatbox.scrollHeight;
        return id;
    }
    
    function removeTypingIndicator(id) {
        const elem = document.getElementById(id);
        if (elem) elem.remove();
    }
    
    function displayMessage(message, role) {
        const messageElement = document.createElement('p');
        messageElement.className = role;
        messageElement.textContent = message;
        chatbox.appendChild(messageElement);
        chatbox.scrollTop = chatbox.scrollHeight;
    }
</script>
    </article>
</div>



<!--Seccion de comentarios-->
<div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://ansiedadtecnologica.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<footer>
    Universidad Técnica Estatal de Quevedo
</footer>
</body>
</html>